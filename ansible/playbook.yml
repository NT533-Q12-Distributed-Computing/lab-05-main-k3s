---
# ================================================================
# 1️⃣ Base setup
# ================================================================
- name: Prepare base packages
  hosts: all
  become: true
  roles:
    - base

# ================================================================
# 2️⃣ Install K3s master
# ================================================================
- name: Install K3s master
  hosts: master
  become: true
  serial: 1
  roles:
    - k3s

# ================================================================
# 3️⃣ Join workers
# ================================================================
- name: Join K3s workers
  hosts: worker
  become: true
  roles:
    - worker

# ================================================================
# 4️⃣ Kubernetes Dashboard
# ================================================================
- name: Install Kubernetes Dashboard
  hosts: master
  become: true
  roles:
    - dashboard

# ================================================================
# 5️⃣ Install OpenFaaS
# ================================================================
- name: Install OpenFaaS
  hosts: master
  become: true
  gather_facts: true
  roles:
    - openfaas
  tags: ["openfaas"]

# ================================================================
# 6️⃣ Deploy Functions
# ================================================================
- name: Deploy microservices functions (Python → Node → Go)
  hosts: master
  become: true
  gather_facts: true
  roles:
    - function
  tags: ["function"]
