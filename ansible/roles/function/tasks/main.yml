---
- name: ğŸ“ Ensure functions directory exists
  file:
    path: /root/functions
    state: directory

# ------------------ FIX FOR WINDOWS (NO RSYNC, NO SFTP) ------------------
- name: ğŸ“ Copy service-a
  copy:
    src: functions/service-a/
    dest: /root/functions/service-a/
    mode: '0755'

- name: ğŸ“ Copy service-b
  copy:
    src: functions/service-b/
    dest: /root/functions/service-b/
    mode: '0755'
# -------------------------------------------------------------------------

- name: ğŸ“ Copy stack.yml
  copy:
    src: stack.yml
    dest: /root/stack.yml

- name: ğŸ“¥ Pull python3-http template
  shell: |
    faas-cli template store pull python3-http
  args:
    chdir: /root

- name: ğŸ›  Build functions
  shell: |
    faas-cli build -f stack.yml
  args:
    chdir: /root

- name: ğŸš€ Deploy functions
  shell: |
    faas-cli deploy -f stack.yml --gateway http://127.0.0.1:8080
  args:
    chdir: /root
